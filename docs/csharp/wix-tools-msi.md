---
layout: page
title: C# - WiX tools MSI
parent: C#
---

# Wix 3 Installer

The Wix (Windows Installer XML) Toolset is used to build MSI packages for your software. You can add a wixproj besides your common C# project and define what you want to be installed, where you want it and even if you want ot create shortcuts for your software. The generated MSI package can be built very administrator friendly and can be built in a automated process, like the DevOps CI build pipe.


# Getting started

Download the Toolkit on [GitHub Releases](https://github.com/wixtoolset/wix3/releases/). The Toolset is allready installed for the `Windows-latest` Azure Container images for your CI build pipe on DevOps. 
For better and easier handling, you can also install the VS extensions [WiX v3 VS Studio Extension](https://wixtoolset.org/docs/wix3/) and the [Wax Extension](https://github.com/tom-englert/Wax). 

[![VS Extensions](/assets/images/coding/csharp/wix-tools-msi/VS-Extensions.png)](/assets/images/coding/csharp/wix-tools-msi/VS-Extensions.png)

Create a project template besides your C# project for the MSI setup. This will create a project with a `wsx` file. This file describes the setup process, the components and all you need to create a good MSI package.

WiX has its own 'compiler' and 'linker' called `candle.exe` and `light.exe`. You could interact with them per CLI, but you can also just use your VS and the default build Tasks in your CI build pipe to build the setup.


# Creating a Setup with an example

I have an example project with a console application, a library and the setup project. The setup project references the console app and the app references its library.
It uses Nerdbank Git Versioning for automatic versioning stamps of the assemblies. It is possible to use the generated Version number for the Setup as well to keep these in sync (recommended).


## wxs file and content

The MSI package contains so called features. These contain Component groups, the groups contain Components and all of this can be seperated in fragments. 

If you activate and use UI dialogs, you can let the user decide if features should be installed or not.


### Product 

The `wsx` file contains the Product information with an GUID id for the setup. this can be autogenerated with an asterix `*`. The Name attribute contains the Product Name of your software. The Manufacturer won't change very often, so it can be hardcoded, like the Product Name. The UpgradeCode is another GUID to be set for each setup. It identifies the product for the OS to know this exact product and must stay the same for each new Version. The OS compares this and the Version number to decide if the product install process is an upgrade or to prevent downgrades of the software.

#### Pack the MSI to single file

The MSI would have a cab archive file per default, but with the `<MediaTemplate EmbedCab="yes" />` setting this will be built within the MSI package to only have a singel output file. 


#### AppIcon and links

If you have an icon file for you application, you can add it to be displayed in the OS application install/uninstall dialog. The setup can also contain help links for further information:

```xml
<!-- Set the icon to be used in "Programs and Features" -->
<Icon Id="AppIcon" SourceFile="$(var.WixInstallerEDU.ProjectDir)Resources\Logo.ico" />
<Property Id="ARPPRODUCTICON" Value="AppIcon" />

<!-- Provide information links to be displayed in "Programs and Features" -->
<Property Id="ARPURLINFOABOUT"  Value="https://..." />
<Property Id="ARPHELPLINK"      Value="https://..." />
<Property Id="ARPURLUPDATEINFO" Value="https://..." />
```

[![OS App dialog](/assets/images/coding/csharp/wix-tools-msi/OS-App-Dialog.png)](/assets/images/coding/csharp/wix-tools-msi/OS-App-Dialog.png)


### Directories

The next part defines the directories where you want to install your software. A good practice is to use the Wix shortcuts to ensure language independent pathing, aswell as a manufacturer folder and a product named folder. You can also set a shortcut for the start menu folder:

```xml
<!-- Directories -->
<Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
        <Directory Id="ProgramFilesFolder">
            <Directory Id="MANUFACTURERFOLDER" Name="!(bind.property.Manufacturer)">
                <Directory Id="INSTALLFOLDER" Name="!(bind.property.ProductName)" />
            </Directory>
        </Directory>
        <!-- Start Menu Folder -->
        <Directory Id="ProgramMenuFolder">
            <Directory Id="ApplicationProgramsFolder" Name="!(bind.property.ProductName)" />
        </Directory>
    </Directory>
</Fragment>

<!-- Provide application and uninstall shortcuts in the start menu-->
<Fragment>
    <ComponentGroup Id="ApplicationShortcuts">
        <Component Id="ApplicationShortcuts" Guid="64ebdde1-4aee-4f8f-b3c5-ce2475cd48b1" Directory="ApplicationProgramsFolder">
            <Shortcut Id="ApplicationShortcut" Name="!(bind.property.ProductName)" Description="Starts !(bind.property.ProductName)" Target="[#$(var.WixInstallerEDU.TargetFileName)]" WorkingDirectory="MAINFOLDER" />
            <Shortcut Id="UninstallShortcut" Name="Uninstall !(bind.property.ProductName)" Description="Uninstalls !(bind.property.ProductName)" Target="[System64Folder]msiexec.exe" Arguments="/x [ProductCode]" />
            <RegistryValue Root="HKCU" Key="Software\!(bind.property.Manufacturer)\!(bind.property.ProductName)" Name="ApplicationShortcutsInstalled" Type="integer" Value="1" KeyPath="yes" />
            <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
        </Component>
    </ComponentGroup>
</Fragment>
```


### Components

The components are the payloads of your installation. These contain teh files to deploy. It is a good practice to have a component for each file and each component needs a unique GUID to be identified. Here you can use the WAX VS extension to help you generate most of the needed files entires:

[![open wax](/assets/images/coding/csharp/wix-tools-msi/VS-tools-Wax.png)](/assets/images/coding/csharp/wix-tools-msi/VS-tools-Wax.png)

[![Wax Editor](/assets/images/coding/csharp/wix-tools-msi/Wax-editor.png)](/assets/images/coding/csharp/wix-tools-msi/Wax-editor.png)

You can reference the needed project and files with clicking through the editor and then add the needed files with the `+` on the right side. The tool then generates the entires and a new GUID for each generated component.


## CI Build Pipe

The CI build pipe now also builds the MSI package. This can be copied to the staging folder seperatly and could be deployed to an admin share.

[![DevOps Drop](/assets/images/coding/csharp/wix-tools-msi/drop.png)](/assets/images/coding/csharp/wix-tools-msi/drop.png)


# Further Information

If you need more MSI functionality or want to look deeper, then check these links:

* [Youtube: Creating Professional Installations with WiX | Tips](https://www.youtube.com/watch?v=usOh3NQO9Ms)
* [Example GitHub for the Youtube Tutorial](https://github.com/SteveIves/SynergyWixExample)


# Complete wsx file

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<?define WixInstallerEDU_TargetDir=$(var.WixInstallerEDU.TargetDir)?>
	<?define ProductVersion="!(bind.FileVersion.MainExeFile)" ?>
	<Product Id="*"
			 Name="WixInstallerEDU"
			 Language="1033"
			 Version="$(var.ProductVersion)"
			 Manufacturer="Your Company Name Here"
			 UpgradeCode="New GUID Here">
		<Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

		<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

		<!-- Pack all files, inlcuding the cab archive into the MSI -->
		<MediaTemplate EmbedCab="yes" />

		<!-- List of features with their components to be installed -->
		<Feature Id="ProductFeature" Title="WixInstallerEDU.Setup" Level="1">
			<ComponentGroupRef Id="ProductComponents" />
			<ComponentGroupRef Id="ApplicationShortcuts" />
		</Feature>

		<!-- Set the icon to be used in "Programs and Features" -->
		<Icon Id="AppIcon" SourceFile="$(var.WixInstallerEDU.ProjectDir)Resources\Logo.ico" />
		<Property Id="ARPPRODUCTICON" Value="AppIcon" />

		<!-- Provide information links to be displayed in "Programs and Features" -->
		<Property Id="ARPURLINFOABOUT"  Value="https://dev.azure.com/OttoChemie/Ausbildung/_git/WixInstallerEDU" />
		<Property Id="ARPHELPLINK"      Value="https://dev.azure.com/OttoChemie/Ausbildung/_git/WixInstallerEDU" />
		<Property Id="ARPURLUPDATEINFO" Value="https://dev.azure.com/OttoChemie/Ausbildung/_git/WixInstallerEDU" />
	</Product>

	<!-- Directories -->
	<Fragment>
		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="ProgramFilesFolder">
				<Directory Id="MANUFACTURERFOLDER" Name="!(bind.property.Manufacturer)">
					<Directory Id="INSTALLFOLDER" Name="!(bind.property.ProductName)" />
				</Directory>
			</Directory>
			<!-- Start Menu Folder -->
			<Directory Id="ProgramMenuFolder">
				<Directory Id="ApplicationProgramsFolder" Name="!(bind.property.ProductName)" />
			</Directory>
		</Directory>
	</Fragment>

	<!-- ComponentGroups with lists of files to be installed -->
	<Fragment>
		<ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
			<!-- Install the main executable and appsettings -->
			<Component Id="MainExeFile" Guid="New GUID Here">
				<File Id="MainExeFile" Name="WixInstallerEDU.exe" KeyPath="yes" Source="$(var.WixInstallerEDU_TargetDir)WixInstallerEDU.exe" Checksum="yes" />
			</Component>
			<Component Id="appsettings.json" Guid="e876f86d-fb1d-40cf-a100-71d06dca0d1b">
				<File Id="appsettings.json" Name ="appsettings.json" Source="$(var.WixInstallerEDU_TargetDir)appsettings.json" />
			</Component>

			<!-- Install wax generated additional dlls and manual set dlls -->
			<Component Id="WixInstallerEDU.runtimeconfig.json" Guid="New GUID Here">
				<File Id="WixInstallerEDU.runtimeconfig.json" Name="WixInstallerEDU.runtimeconfig.json" Source="$(var.WixInstallerEDU_TargetDir)WixInstallerEDU.runtimeconfig.json" />
			</Component>
			
            <!-- ... -->

		</ComponentGroup>
	</Fragment>

	<!-- Provide application and uninstall shortcuts in the start menu-->
	<Fragment>
		<ComponentGroup Id="ApplicationShortcuts">
			<Component Id="ApplicationShortcuts" Guid="New GUID Here" Directory="ApplicationProgramsFolder">
				<Shortcut Id="ApplicationShortcut" Name="!(bind.property.ProductName)" Description="Starts !(bind.property.ProductName)" Target="[#$(var.WixInstallerEDU.TargetFileName)]" WorkingDirectory="MAINFOLDER" />
				<Shortcut Id="UninstallShortcut" Name="Uninstall !(bind.property.ProductName)" Description="Uninstalls !(bind.property.ProductName)" Target="[System64Folder]msiexec.exe" Arguments="/x [ProductCode]" />
				<RegistryValue Root="HKCU" Key="Software\!(bind.property.Manufacturer)\!(bind.property.ProductName)" Name="ApplicationShortcutsInstalled" Type="integer" Value="1" KeyPath="yes" />
				<RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
			</Component>
		</ComponentGroup>
	</Fragment>
</Wix>
```